{% extends "layouts/base.html" %}
{% load static %}

{% block notitle %}{% endblock %}

{% block head %}
    <link rel="stylesheet" href="{% static "css/index.css" %}">
    <script src="{% static "components/card.js" %}"></script>
    <script src="{% static "components/tag.js" %}"></script>
    <script src="{% static "components/commission-card.js" %}"></script>
    <script src="{% static "components/multiword.js" %}"></script>
    <script src="{% static "components/event-card.js" %}"></script>
    <script src="{% static "components/shelf.js" %}"></script>
    <script src="{% static "components/autoresize.js" %}"></script>
    <script src="{% static "components/timeline.js" %}"></script>
{% endblock %}

{% block body %}

    <div class="jumbo">
        <div class="title-wrapper">
            <h2 class="jumbo-title" >Viens <bde-multiword>
                <span>t'amuser</span>
                <span>faire du sport</span>
                <span>découvrir</span>
                <span>créer</span>
                <span>faire des rencontres</span>
                <span>manger</span>
                <span>jouer</span>
                <span>inventer</span>
                <span>discuter</span>
                <span>t'entrainer</span>
            </bde-multiword> le jeudi après-midi</h2>
        </div>
        <p class="jumbo-content" >Tu peux dès maintenant créer ta commission et être financé par le BDE pour toutes les activités de la vie associative ! Sois créatif, tout est permis !</p>
        <div class="buttons">
            <a class="button primary" href="/commissions">Parcourir les commissions</a>
            {% if not user.is_authenticated or perms.commissions.add_commission %}
                <a class="button" href="/commissions/create">Créer une commission</a>
            {% endif %}
        </div>
    </div>

    {% if quick_links %}
    <ul class="quick-link-list">
        {% for link in quick_links %}
            <li class="quick-link {{ link.style }}">
                <a href="{{ link.url }}">
                    {% if link.icon %}<bde-icon icon="{{ link.icon }}"></bde-icon>{% endif %}
                    <span class="text">{{ link.text }}</span>
                </a>
            </li>
        {% endfor %}
    </ul>
    {% endif %}

    {% if upcoming_events %}
    <bde-shelf>
        <h2 slot="title">Événements à venir</h2>
        <a href="/commissions/events" class="btn" slot="toolbar">Calendrier <bde-icon icon="mdi-chevron-right"></bde-icon></a>
        {% for event in upcoming_events %}
            <a href="/commissions/{{ event.commission.slug }}/event-{{ event.slug }}">
                {% include "fragments/event-card.html" %}
            </a>
        {% endfor %}
    </bde-shelf>
    {% endif %}

    <bde-shelf>
        <h2 slot="title" >Dernières commissions</h2>
        <a href="/commissions" class="btn" slot="toolbar">Toutes les commissions <bde-icon icon="mdi-chevron-right"></bde-icon></a>
        {% for com in latest_commissions %}
            {% include "fragments/commission-card.html" %}
        {% endfor %}

        {% if commission_count > 5 %}
            <div class="more-card-wrapper">
                <bde-card class="more-card">
                    <a class="more" href="/commissions">
                        <bde-icon icon="mdi-creation" ></bde-icon>
                        <div>Encore {{ commission_count }} commissions à découvrir</div>
                    </a>
                </bde-card>
            </div>
        {% else %}
            {% if not user.is_authenticated or perms.commissions.add_commission %}
                <bde-card class="create-commission">
                    <a href="/commissions/create">
                        <div class="title">Toi aussi, sois acteur de la vie asso !</div>
                        <span class="iconify" data-icon="mdi-creation"></span>
                        <div>Crée ta commission et sois financé !</div>
                    </a>
                </bde-card>
            {% endif %}
        {% endif %}
    </bde-shelf>


    {% if commission_count > 5 %}
        <bde-shelf>
            <h2 slot="title">Quelques commissions à découvrir</h2>
            <a href="/commissions" class="btn" slot="toolbar">Toutes les commissions <bde-icon icon="mdi-chevron-right"></bde-icon></a>
            {% for com in random_commissions %}
                {% include "fragments/commission-card.html" %}
            {% endfor %}

            {% if commission_count > 5 %}
            <div class="more-card-wrapper">
                <bde-card class="more-card">
                    <a class="more" href="/commissions">
                        <bde-icon icon="mdi-creation" ></bde-icon>
                        <div>Encore {{ commission_count }} commissions à découvrir</div>
                    </a>
                </bde-card>
            </div>
            {% endif %}
        </bde-shelf>
    {% endif %}

    {%  if past_events_count > 0 %}
    <div class="body-section">
        <h2 class="section-title timeline-title" >Activité de la Vie Asso</h2>
        <bde-timeline class="timeline">
            {% for event in past_events %}
                <a
                        href="/commissions/{{ event.commission.slug }}/event-{{ event.slug }}"
                        timeline-date="{{ event.event_date_start | date:"c" }}"
                        timeline-id="event-{{ event.id }}">
                    {% include "fragments/event-card.html" %}
                </a>
            {% endfor %}
            {% for post in post_list %}
                <div    class="post source-{{ post.source }}"
                        timeline-date="{{ post.date | date:"c" }}"
                        timeline-id="post-{{ post.id }}">
                    <div class="post-header">
                        <div class="post-author">
                            {% if post.author %}{% include "fragments/safe_user.html" with user=post.author %}{% else %}
                                {% if post.source == "twitter" %}
                                    <bde-user href="https://twitter.com/{{ post.author_text }}">{{ post.author_text }}</bde-user>
                                {% else %}
                                    <bde-user>{{ post.author_text }}</bde-user>
                                {% endif %}
                            {% endif %}
                        </div>
                        <div class="post-header-separator"></div>
                        <div class="post-source">
                            {% if post.source == "twitter" %}
                            <a target="_blank" href="https://twitter.com/{{ post.author_text }}/status/{{ post.external_id }}" class="source-link">
                                <bde-icon icon="mdi:twitter"></bde-icon>
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    <div class="post-content">
                        <bde-autoresize>
                            {{ post.content }}
                        </bde-autoresize>
                    </div>
                    <div class="post-footer">
                        <a class="post-commission" href="{% url 'commission_view' post.commission.slug %}">
                            {% include "fragments/compact-commission.html" with com=post.commission %}
                        </a>
                    </div>
                </div>
            {% endfor %}
        </bde-timeline>
    </div>
    {% endif %}

{% endblock %}